<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Avatar Generator - Lucifex</title>
  <style>
    body { 
      margin: 0; 
      overflow: hidden; 
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    #controls {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 300px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .control-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
    }
    
    input[type="range"] {
      width: 100%;
      margin-bottom: 5px;
    }
    
    .value-display {
      font-size: 12px;
      color: #666;
      text-align: right;
    }
    
    #info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      color: white;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 5px;
    }
    
    h3 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #667eea;
      padding-bottom: 5px;
    }

    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 18px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="loading">Loading Avatar Generator...</div>
  
  <div id="controls" style="display: none;">
    <h3>Body Measurements</h3>
    
    <div class="control-group">
      <label for="height">Height</label>
      <input type="range" id="height" min="150" max="200" value="170" />
      <div class="value-display"><span id="height-value">170</span> cm</div>
    </div>
    
    <div class="control-group">
      <label for="chest">Chest/Bust</label>
      <input type="range" id="chest" min="70" max="120" value="90" />
      <div class="value-display"><span id="chest-value">90</span> cm</div>
    </div>
    
    <div class="control-group">
      <label for="waist">Waist</label>
      <input type="range" id="waist" min="60" max="110" value="75" />
      <div class="value-display"><span id="waist-value">75</span> cm</div>
    </div>
    
    <div class="control-group">
      <label for="hips">Hips</label>
      <input type="range" id="hips" min="70" max="130" value="95" />
      <div class="value-display"><span id="hips-value">95</span> cm</div>
    </div>
    
    <div class="control-group">
      <label for="shoulders">Shoulder Width</label>
      <input type="range" id="shoulders" min="35" max="55" value="42" />
      <div class="value-display"><span id="shoulders-value">42</span> cm</div>
    </div>
    
    <div class="control-group">
      <label for="armLength">Arm Length</label>
      <input type="range" id="armLength" min="55" max="75" value="65" />
      <div class="value-display"><span id="armLength-value">65</span> cm</div>
    </div>
    
    <div class="control-group">
      <label for="legLength">Leg Length</label>
      <input type="range" id="legLength" min="70" max="110" value="90" />
      <div class="value-display"><span id="legLength-value">90</span> cm</div>
    </div>
  </div>
  
  <div id="info" style="display: none;">
    <strong>Controls:</strong><br>
    Mouse: Rotate view<br>
    Scroll: Zoom<br>
    Adjust sliders to modify avatar
  </div>

  <!-- Load Three.js -->
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  
  <script type="module">
    // Import OrbitControls as ES6 module
    import { OrbitControls } from 'https://unpkg.com/three@0.158.0/examples/jsm/controls/OrbitControls.js';
    
    // Wait for everything to load
    window.addEventListener('load', function() {
      // Check if THREE is available
      if (typeof THREE === 'undefined') {
        document.getElementById('loading').innerHTML = 'Error: Three.js failed to load. Please check your internet connection.';
        return;
      }

      // Hide loading, show controls
      document.getElementById('loading').style.display = 'none';
      document.getElementById('controls').style.display = 'block';
      document.getElementById('info').style.display = 'block';

      // Scene setup
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0xf0f0f0);
      
      const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 1.6, 4);
      
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      document.body.appendChild(renderer.domElement);
      
      // Controls - Now using imported OrbitControls
      const controls = new OrbitControls(camera, renderer.domElement);
      controls.target.set(0, 1, 0);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      
      // Lighting
      const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
      scene.add(ambientLight);
      
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(5, 10, 5);
      directionalLight.castShadow = true;
      directionalLight.shadow.mapSize.width = 2048;
      directionalLight.shadow.mapSize.height = 2048;
      scene.add(directionalLight);
      
      const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
      fillLight.position.set(-5, 5, -5);
      scene.add(fillLight);
      
      // Ground plane
      const groundGeometry = new THREE.PlaneGeometry(10, 10);
      const groundMaterial = new THREE.MeshLambertMaterial({ color: 0xcccccc });
      const ground = new THREE.Mesh(groundGeometry, groundMaterial);
      ground.rotation.x = -Math.PI / 2;
      ground.receiveShadow = true;
      scene.add(ground);
      
      // Avatar parts
      const avatarGroup = new THREE.Group();
      scene.add(avatarGroup);
      
      // Materials
      const skinMaterial = new THREE.MeshLambertMaterial({ color: 0xffdbac });
      
      // Body parts
      let head, torso, leftArm, rightArm, leftLeg, rightLeg;
      
      function createAvatar() {
        // Clear existing avatar
        avatarGroup.clear();
        
        // Head
        const headGeometry = new THREE.SphereGeometry(0.12, 16, 16);
        head = new THREE.Mesh(headGeometry, skinMaterial);
        head.position.y = 1.65;
        head.castShadow = true;
        avatarGroup.add(head);
        
        // Torso
        const torsoGeometry = new THREE.CylinderGeometry(0.15, 0.12, 0.6, 12);
        torso = new THREE.Mesh(torsoGeometry, skinMaterial);
        torso.position.y = 1.2;
        torso.castShadow = true;
        avatarGroup.add(torso);
        
        // Arms
        const armGeometry = new THREE.CylinderGeometry(0.04, 0.04, 0.5, 8);
        
        leftArm = new THREE.Mesh(armGeometry, skinMaterial);
        leftArm.position.set(-0.25, 1.3, 0);
        leftArm.rotation.z = Math.PI / 6;
        leftArm.castShadow = true;
        avatarGroup.add(leftArm);
        
        rightArm = new THREE.Mesh(armGeometry, skinMaterial);
        rightArm.position.set(0.25, 1.3, 0);
        rightArm.rotation.z = -Math.PI / 6;
        rightArm.castShadow = true;
        avatarGroup.add(rightArm);
        
        // Legs
        const legGeometry = new THREE.CylinderGeometry(0.06, 0.05, 0.8, 8);
        
        leftLeg = new THREE.Mesh(legGeometry, skinMaterial);
        leftLeg.position.set(-0.1, 0.5, 0);
        leftLeg.castShadow = true;
        avatarGroup.add(leftLeg);
        
        rightLeg = new THREE.Mesh(legGeometry, skinMaterial);
        rightLeg.position.set(0.1, 0.5, 0);
        rightLeg.castShadow = true;
        avatarGroup.add(rightLeg);
      }
      
      function updateAvatar() {
        const measurements = {
          height: parseInt(document.getElementById('height').value),
          chest: parseInt(document.getElementById('chest').value),
          waist: parseInt(document.getElementById('waist').value),
          hips: parseInt(document.getElementById('hips').value),
          shoulders: parseInt(document.getElementById('shoulders').value),
          armLength: parseInt(document.getElementById('armLength').value),
          legLength: parseInt(document.getElementById('legLength').value)
        };
        
        // Scale avatar based on height (170cm = baseline)
        const heightScale = measurements.height / 170;
        avatarGroup.scale.y = heightScale;
        
        // Adjust torso based on chest/waist measurements
        const chestScale = measurements.chest / 90; // 90cm baseline
        const waistScale = measurements.waist / 75; // 75cm baseline
        
        if (torso) {
          torso.scale.x = chestScale;
          torso.scale.z = chestScale;
          
          // Create tapered torso effect
          torso.geometry.dispose(); // Clean up old geometry
          torso.geometry = new THREE.CylinderGeometry(
            0.15 * chestScale, 
            0.12 * waistScale, 
            0.6, 
            12
          );
        }
        
        // Adjust shoulder width
        const shoulderScale = measurements.shoulders / 42; // 42cm baseline
        if (leftArm && rightArm) {
          leftArm.position.x = -0.25 * shoulderScale;
          rightArm.position.x = 0.25 * shoulderScale;
          
          // Adjust arm length
          const armScale = measurements.armLength / 65; // 65cm baseline
          leftArm.scale.y = armScale;
          rightArm.scale.y = armScale;
        }
        
        // Adjust leg length
        const legScale = measurements.legLength / 90; // 90cm baseline
        if (leftLeg && rightLeg) {
          leftLeg.scale.y = legScale;
          rightLeg.scale.y = legScale;
          leftLeg.position.y = 0.5 * legScale;
          rightLeg.position.y = 0.5 * legScale;
        }
        
        // Adjust hip width
        const hipScale = measurements.hips / 95; // 95cm baseline
        if (leftLeg && rightLeg) {
          leftLeg.position.x = -0.1 * hipScale;
          rightLeg.position.x = 0.1 * hipScale;
          leftLeg.scale.x = hipScale * 0.8;
          rightLeg.scale.x = hipScale * 0.8;
          leftLeg.scale.z = hipScale * 0.8;
          rightLeg.scale.z = hipScale * 0.8;
        }
      }
      
      // Event listeners for controls
      function setupControls() {
        const sliders = ['height', 'chest', 'waist', 'hips', 'shoulders', 'armLength', 'legLength'];
        
        sliders.forEach(id => {
          const slider = document.getElementById(id);
          const valueDisplay = document.getElementById(id + '-value');
          
          slider.addEventListener('input', (e) => {
            valueDisplay.textContent = e.target.value;
            updateAvatar();
          });
        });
      }
      
      // Handle window resize
      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
      window.addEventListener('resize', onWindowResize);
      
      // Animation loop
      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      }
      
      // Initialize
      try {
        createAvatar();
        setupControls();
        updateAvatar();
        animate();
        console.log('Avatar Generator loaded successfully!');
      } catch (error) {
        console.error('Error initializing avatar:', error);
        document.getElementById('loading').innerHTML = 'Error initializing avatar. Check console for details.';
        document.getElementById('loading').style.display = 'block';
        document.getElementById('controls').style.display = 'none';
        document.getElementById('info').style.display = 'none';
      }
    });
  </script>
</body>
</html>
