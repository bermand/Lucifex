<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucifex - Garment Visualization</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="https://unpkg.com/@google/model-viewer@4.1.0/dist/model-viewer.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <h1>üß¨ Lucifex</h1>
                    <span class="subtitle">Garment Visualization</span>
                </div>
                <div class="header-controls">
                    <div class="status-indicators">
                        <div id="physics-indicator" class="status-indicator error">
                            <span class="status-dot"></span>
                            <span class="status-text">Physics: Disabled</span>
                        </div>
                        <div id="model-indicator" class="status-indicator">
                            <span class="status-dot"></span>
                            <span class="status-text">Models: Loading...</span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button id="take-screenshot" class="btn btn-secondary">
                            <span class="btn-icon">üì∏</span>
                            Screenshot
                        </button>
                        <button id="export-scene" class="btn btn-secondary">
                            <span class="btn-icon">üíæ</span>
                            Export
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Tab Navigation -->
                <nav class="tab-nav">
                    <button class="tab active" data-tab="avatar">
                        <span class="tab-icon">üë§</span>
                        Avatar
                    </button>
                    <button class="tab" data-tab="garment">
                        <span class="tab-icon">üëï</span>
                        Garment
                    </button>
                    <button class="tab" data-tab="combined">
                        <span class="tab-icon">üé≠</span>
                        Combined
                    </button>
                    <button class="tab" data-tab="physics">
                        <span class="tab-icon">üß¨</span>
                        Physics
                    </button>
                    <button class="tab" data-tab="environment">
                        <span class="tab-icon">üåç</span>
                        Environment
                    </button>
                </nav>

                <!-- Tab Contents -->
                <div class="tab-contents">
                    <!-- Avatar Tab -->
                    <div id="avatar-tab" class="tab-content active">
                        <div class="section">
                            <h3>Avatar Selection</h3>
                            <div class="avatar-options">
                                <button class="avatar-option" data-avatar="male">
                                    <span class="option-icon">üöπ</span>
                                    Male
                                </button>
                                <button class="avatar-option" data-avatar="female">
                                    <span class="option-icon">üö∫</span>
                                    Female
                                </button>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Custom Avatar</h3>
                            <div class="file-upload">
                                <input type="file" id="avatar-file" accept=".glb,.gltf" hidden>
                                <label for="avatar-file" class="file-upload-btn">
                                    <span class="btn-icon">üìÅ</span>
                                    Upload Avatar
                                </label>
                                <div id="avatar-file-info" class="file-info"></div>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Avatar Controls</h3>
                            <div class="control-group">
                                <label for="avatar-scale">Scale</label>
                                <div class="range-control">
                                    <input type="range" id="avatar-scale" min="0.1" max="3.0" step="0.1" value="1.0">
                                    <span id="avatar-scale-value" class="range-value">1.0</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="avatar-opacity">Opacity</label>
                                <div class="range-control">
                                    <input type="range" id="avatar-opacity" min="0.0" max="1.0" step="0.1" value="1.0">
                                    <span id="avatar-opacity-value" class="range-value">1.0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Garment Tab -->
                    <div id="garment-tab" class="tab-content">
                        <div class="section">
                            <h3>Garment Presets</h3>
                            <div class="preset-grid">
                                <button class="preset-btn" data-garment="tshirt">
                                    <span class="preset-icon">üëï</span>
                                    T-Shirt
                                </button>
                                <button class="preset-btn" data-garment="tshirt-1">
                                    <span class="preset-icon">üëî</span>
                                    T-Shirt 1
                                </button>
                                <button class="preset-btn" data-garment="thsirt">
                                    <span class="preset-icon">üéΩ</span>
                                    Tank Top
                                </button>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Custom Garment</h3>
                            <div class="file-upload">
                                <input type="file" id="garment-file" accept=".glb,.gltf" hidden>
                                <label for="garment-file" class="file-upload-btn">
                                    <span class="btn-icon">üìÅ</span>
                                    Upload Garment
                                </label>
                                <div id="garment-file-info" class="file-info"></div>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Garment Controls</h3>
                            <div class="control-group">
                                <label for="garment-scale">Scale</label>
                                <div class="range-control">
                                    <input type="range" id="garment-scale" min="0.1" max="3.0" step="0.1" value="1.0">
                                    <span id="garment-scale-value" class="range-value">1.0</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="garment-opacity">Opacity</label>
                                <div class="range-control">
                                    <input type="range" id="garment-opacity" min="0.0" max="1.0" step="0.1" value="1.0">
                                    <span id="garment-opacity-value" class="range-value">1.0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Combined Tab -->
                    <div id="combined-tab" class="tab-content">
                        <div class="section">
                            <h3>Combination Method</h3>
                            <div class="preset-grid">
                                <button class="preset-btn active" data-combination="overlay">
                                    <span class="preset-icon">üé≠</span>
                                    Overlay
                                </button>
                                <button class="preset-btn" data-combination="blend">
                                    <span class="preset-icon">üåà</span>
                                    Blend
                                </button>
                                <button class="preset-btn" data-combination="physics">
                                    <span class="preset-icon">üß¨</span>
                                    Physics
                                </button>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Combined Controls</h3>
                            <div class="control-group">
                                <label for="garment-scale-combined">Garment Scale</label>
                                <div class="range-control">
                                    <input type="range" id="garment-scale-combined" min="0.1" max="3.0" step="0.1" value="1.0">
                                    <span id="garment-scale-combined-value" class="range-value">1.0</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="garment-offset-x">X Position</label>
                                <div class="range-control">
                                    <input type="range" id="garment-offset-x" min="-2.0" max="2.0" step="0.1" value="0.0">
                                    <span id="garment-offset-x-value" class="range-value">0.0</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="garment-offset-y">Y Position</label>
                                <div class="range-control">
                                    <input type="range" id="garment-offset-y" min="-2.0" max="2.0" step="0.1" value="0.0">
                                    <span id="garment-offset-y-value" class="range-value">0.0</span>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Actions</h3>
                            <div class="action-buttons">
                                <button id="generate-combined" class="btn btn-primary">
                                    <span class="btn-icon">üéØ</span>
                                    Generate Combined
                                </button>
                                <button id="reset-combination" class="btn btn-secondary">
                                    <span class="btn-icon">üîÑ</span>
                                    Reset
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Physics Tab -->
                    <div id="physics-tab" class="tab-content">
                        <div class="section">
                            <h3>Physics Control</h3>
                            <div class="physics-main-controls">
                                <button id="physics-toggle" class="btn btn-primary">
                                    <span class="btn-icon">üß¨</span>
                                    Enable Physics
                                </button>
                            </div>
                        </div>

                        <div id="physics-controls" class="section" style="display: none;">
                            <h3>Physics Settings</h3>
                            <div class="control-group">
                                <label for="cloth-stiffness">Cloth Stiffness</label>
                                <div class="range-control">
                                    <input type="range" id="cloth-stiffness" min="0.1" max="2.0" step="0.1" value="1.0">
                                    <span id="cloth-stiffness-value" class="range-value">1.0</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="gravity-strength">Gravity</label>
                                <div class="range-control">
                                    <input type="range" id="gravity-strength" min="0.0" max="2.0" step="0.1" value="1.0">
                                    <span id="gravity-strength-value" class="range-value">1.0</span>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Physics Actions</h3>
                            <div class="action-buttons">
                                <button id="drop-test" class="btn btn-primary">
                                    <span class="btn-icon">üé¨</span>
                                    Drop Test
                                </button>
                                <button id="basic-test" class="btn btn-secondary">
                                    <span class="btn-icon">üß™</span>
                                    Basic Test
                                </button>
                                <button id="physics-reset" class="btn btn-secondary">
                                    <span class="btn-icon">üîÑ</span>
                                    Reset Physics
                                </button>
                                <button id="reset-cloth" class="btn btn-secondary">
                                    <span class="btn-icon">üìç</span>
                                    Reset Cloth
                                </button>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Debug</h3>
                            <div class="action-buttons">
                                <button id="debug-toggle" class="btn btn-secondary">
                                    <span class="btn-icon">üîç</span>
                                    Show Debug
                                </button>
                                <button id="debug-log" class="btn btn-secondary">
                                    <span class="btn-icon">üìä</span>
                                    Log Status
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Environment Tab -->
                    <div id="environment-tab" class="tab-content">
                        <div class="section">
                            <h3>Environment</h3>
                            <div class="env-grid">
                                <button class="env-btn active" data-environment="studio">
                                    <span class="env-icon">üè¢</span>
                                    Studio
                                </button>
                                <button class="env-btn" data-environment="sunset">
                                    <span class="env-icon">üåÖ</span>
                                    Sunset
                                </button>
                                <button class="env-btn" data-environment="forest">
                                    <span class="env-icon">üå≤</span>
                                    Forest
                                </button>
                                <button class="env-btn" data-environment="city">
                                    <span class="env-icon">üèôÔ∏è</span>
                                    City
                                </button>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Lighting</h3>
                            <div class="control-group">
                                <label for="exposure">Exposure</label>
                                <div class="range-control">
                                    <input type="range" id="exposure" min="0.0" max="3.0" step="0.1" value="1.0">
                                    <span id="exposure-value" class="range-value">1.0</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="shadow-intensity">Shadow Intensity</label>
                                <div class="range-control">
                                    <input type="range" id="shadow-intensity" min="0.0" max="3.0" step="0.1" value="1.0">
                                    <span id="shadow-intensity-value" class="range-value">1.0</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="shadow-softness">Shadow Softness</label>
                                <div class="range-control">
                                    <input type="range" id="shadow-softness" min="0.0" max="1.0" step="0.1" value="0.5">
                                    <span id="shadow-softness-value" class="range-value">0.5</span>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Tone Mapping</h3>
                            <div class="preset-grid">
                                <button class="preset-btn active" data-tone-mapping="aces">
                                    <span class="preset-icon">üé®</span>
                                    ACES
                                </button>
                                <button class="preset-btn" data-tone-mapping="linear">
                                    <span class="preset-icon">üìè</span>
                                    Linear
                                </button>
                                <button class="preset-btn" data-tone-mapping="reinhard">
                                    <span class="preset-icon">üåà</span>
                                    Reinhard
                                </button>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Camera</h3>
                            <div class="action-buttons">
                                <button id="auto-rotate-toggle" class="btn btn-secondary">
                                    <span class="btn-icon">üîÑ</span>
                                    Auto Rotate
                                </button>
                                <button id="camera-reset" class="btn btn-secondary">
                                    <span class="btn-icon">üì∑</span>
                                    Reset Camera
                                </button>
                                <button id="focus-model" class="btn btn-secondary">
                                    <span class="btn-icon">üéØ</span>
                                    Focus Model
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Viewer Area -->
            <section class="viewer-area">
                <!-- Model Type Selector -->
                <div class="model-type-selector">
                    <button class="model-btn" data-model-type="avatar">
                        <span class="btn-icon">üë§</span>
                        Avatar Only
                    </button>
                    <button class="model-btn" data-model-type="garment">
                        <span class="btn-icon">üëï</span>
                        Garment Only
                    </button>
                    <button class="model-btn active" data-model-type="both">
                        <span class="btn-icon">üé≠</span>
                        Combined View
                    </button>
                </div>

                <!-- Viewer Container -->
                <div class="viewer-container">
                    <!-- Single Model Viewer -->
                    <model-viewer 
                        id="main-viewer"
                        alt="3D Model"
                        camera-controls
                        auto-rotate
                        shadow-intensity="1"
                        exposure="1"
                        environment-image="neutral"
                        style="display: none;">
                    </model-viewer>

                    <!-- Combined Viewer Container -->
                    <div id="combined-viewer-container" class="combined-viewer">
                        <!-- Combined viewers will be dynamically created here -->
                    </div>
                </div>

                <!-- Model Info -->
                <div class="model-info">
                    <div class="info-item">
                        <span class="info-label">Model:</span>
                        <span id="model-name" class="info-value">Loading...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Type:</span>
                        <span id="model-type" class="info-value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Status:</span>
                        <span id="model-status" class="info-value">Initializing...</span>
                    </div>
                </div>
            </section>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-content">
                <div class="status-left">
                    <span id="app-status" class="status-text">Initializing Lucifex Garment Visualizer...</span>
                </div>
                <div class="status-right">
                    <div class="combination-status">
                        <span class="status-label">Combination:</span>
                        <span id="combination-status" class="status-value">Not Ready</span>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Physics Effect Overlay -->
        <div id="physics-effect" class="physics-effect"></div>
    </div>

    <!-- Load Main Application -->
    <script type="module" src="main.js"></script>

    <!-- Live Reload for Development -->
    <script>
        // Live reload for development
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
            console.log('Live reload enabled.');
            try {
                const ws = new WebSocket('ws://localhost:35729/');
                ws.onmessage = (event) => {
                    if (event.data === 'reload') {
                        location.reload();
                    }
                };
                ws.onerror = () => {
                    console.log("WebSocket connection to 'ws://localhost:35729/' failed:");
                };
            } catch (error) {
                console.log("WebSocket connection to 'ws://localhost:35729/' failed:");
            }
        }
    </script>
</body>
</html>
