<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucifex - Garment Visualization</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ­ Lucifex Garment Visualizer</h1>
            <div class="status-bar">
                <div id="status" class="status">Ready</div>
                <div id="physics-status" class="physics-status">Physics: Disabled</div>
            </div>
        </header>

        <div class="main-content">
            <!-- Tab Navigation -->
            <div class="tabs">
                <button class="tab active" data-tab="avatar">ğŸ‘¤ Avatar</button>
                <button class="tab" data-tab="garment">ğŸ‘• Garment</button>
                <button class="tab" data-tab="combined">ğŸ­ Combined</button>
                <button class="tab" data-tab="physics">ğŸ§¬ Physics</button>
                <button class="tab" data-tab="environment">ğŸŒ Environment</button>
            </div>

            <!-- Tab Content -->
            <div class="tab-contents">
                <!-- Avatar Tab -->
                <div id="avatar-tab" class="tab-content active">
                    <div class="controls-section">
                        <h3>Avatar Selection</h3>
                        <div class="avatar-options">
                            <button class="avatar-option" data-avatar="male">ğŸ‘¨ Male</button>
                            <button class="avatar-option" data-avatar="female">ğŸ‘© Female</button>
                        </div>
                        
                        <div class="file-upload">
                            <label for="avatar-file">Upload Custom Avatar:</label>
                            <input type="file" id="avatar-file" accept=".glb,.gltf">
                            <div id="avatar-file-info" class="file-info"></div>
                        </div>

                        <div class="controls">
                            <div class="control-group">
                                <label for="avatar-scale">Scale:</label>
                                <input type="range" id="avatar-scale" min="0.1" max="3" step="0.1" value="1">
                                <span id="avatar-scale-value">1</span>
                            </div>
                            <div class="control-group">
                                <label for="avatar-opacity">Opacity:</label>
                                <input type="range" id="avatar-opacity" min="0" max="1" step="0.1" value="1">
                                <span id="avatar-opacity-value">1</span>
                            </div>
                        </div>
                    </div>

                    <div class="viewer-section">
                        <div class="model-type-selector">
                            <button class="model-btn active" data-model-type="avatar">ğŸ‘¤ Avatar Only</button>
                            <button class="model-btn" data-model-type="garment">ğŸ‘• Garment Only</button>
                            <button class="model-btn" data-model-type="both">ğŸ­ Combined View</button>
                        </div>
                        <div class="viewer-container">
                            <model-viewer id="main-viewer" 
                                camera-controls 
                                auto-rotate 
                                environment-image="neutral"
                                exposure="1"
                                shadow-intensity="1"
                                shadow-softness="0.5">
                            </model-viewer>
                        </div>
                    </div>
                </div>

                <!-- Garment Tab -->
                <div id="garment-tab" class="tab-content">
                    <div class="controls-section">
                        <h3>Garment Selection</h3>
                        <div class="garment-options">
                            <button class="preset-btn" data-garment="tshirt">ğŸ‘• T-Shirt</button>
                            <button class="preset-btn" data-garment="tshirt-1">ğŸ‘” Shirt</button>
                            <button class="preset-btn" data-garment="dress">ğŸ‘— Dress</button>
                        </div>
                        
                        <div class="file-upload">
                            <label for="garment-file">Upload Custom Garment:</label>
                            <input type="file" id="garment-file" accept=".glb,.gltf">
                            <div id="garment-file-info" class="file-info"></div>
                        </div>

                        <div class="controls">
                            <div class="control-group">
                                <label for="garment-scale">Scale:</label>
                                <input type="range" id="garment-scale" min="0.1" max="3" step="0.1" value="1">
                                <span id="garment-scale-value">1</span>
                            </div>
                            <div class="control-group">
                                <label for="garment-opacity">Opacity:</label>
                                <input type="range" id="garment-opacity" min="0" max="1" step="0.1" value="1">
                                <span id="garment-opacity-value">1</span>
                            </div>
                            <div class="control-group">
                                <label for="garment-offset-x">Position X:</label>
                                <input type="range" id="garment-offset-x" min="-2" max="2" step="0.1" value="0">
                                <span id="garment-offset-x-value">0</span>
                            </div>
                            <div class="control-group">
                                <label for="garment-offset-y">Position Y:</label>
                                <input type="range" id="garment-offset-y" min="-2" max="2" step="0.1" value="0">
                                <span id="garment-offset-y-value">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="viewer-section">
                        <div class="model-type-selector">
                            <button class="model-btn" data-model-type="avatar">ğŸ‘¤ Avatar Only</button>
                            <button class="model-btn active" data-model-type="garment">ğŸ‘• Garment Only</button>
                            <button class="model-btn" data-model-type="both">ğŸ­ Combined View</button>
                        </div>
                        <div class="viewer-container">
                            <model-viewer id="garment-viewer" 
                                camera-controls 
                                auto-rotate 
                                environment-image="neutral"
                                exposure="1"
                                shadow-intensity="1"
                                shadow-softness="0.5">
                            </model-viewer>
                        </div>
                    </div>
                </div>

                <!-- Combined Tab -->
                <div id="combined-tab" class="tab-content">
                    <div class="controls-section">
                        <h3>Combined View Controls</h3>
                        
                        <div class="combination-methods">
                            <h4>Combination Method:</h4>
                            <button class="preset-btn active" data-combination="overlay">ğŸ­ Overlay</button>
                            <button class="preset-btn" data-combination="blend">ğŸŒˆ Blend</button>
                            <button class="preset-btn" data-combination="physics">ğŸ§¬ Physics</button>
                        </div>

                        <div class="controls">
                            <div class="control-group">
                                <label for="garment-scale-combined">Garment Scale:</label>
                                <input type="range" id="garment-scale-combined" min="0.1" max="3" step="0.1" value="1">
                                <span id="garment-scale-combined-value">1</span>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button id="generate-combined" class="action-btn">ğŸ­ Generate Combined</button>
                            <button id="reset-combination" class="action-btn">ğŸ”„ Reset</button>
                        </div>
                    </div>

                    <div class="viewer-section">
                        <div class="model-type-selector">
                            <button class="model-btn" data-model-type="avatar">ğŸ‘¤ Avatar Only</button>
                            <button class="model-btn" data-model-type="garment">ğŸ‘• Garment Only</button>
                            <button class="model-btn active" data-model-type="both">ğŸ­ Combined View</button>
                        </div>
                        <div class="viewer-container">
                            <div class="combined-viewer">
                                <model-viewer id="avatar-viewer" 
                                    camera-controls 
                                    auto-rotate 
                                    environment-image="neutral"
                                    exposure="1"
                                    shadow-intensity="1"
                                    shadow-softness="0.5">
                                </model-viewer>
                                <model-viewer id="combined-garment-viewer" 
                                    camera-controls 
                                    auto-rotate 
                                    environment-image="neutral"
                                    exposure="1"
                                    shadow-intensity="1"
                                    shadow-softness="0.5">
                                </model-viewer>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Physics Tab -->
                <div id="physics-tab" class="tab-content">
                    <div class="controls-section">
                        <h3>Physics Simulation</h3>
                        
                        <div class="physics-controls">
                            <button id="physics-toggle" class="action-btn">ğŸ§¬ Enable Physics</button>
                            <button id="physics-reset" class="action-btn">ğŸ”„ Reset Physics</button>
                            <button id="reset-cloth" class="action-btn">ğŸ“ Reset Cloth</button>
                        </div>

                        <div id="physics-controls" class="controls" style="display: none;">
                            <div class="control-group">
                                <label for="cloth-stiffness">Cloth Stiffness:</label>
                                <input type="range" id="cloth-stiffness" min="0.1" max="1" step="0.1" value="0.4">
                                <span id="cloth-stiffness-value">0.4</span>
                            </div>
                            <div class="control-group">
                                <label for="gravity-strength">Gravity:</label>
                                <input type="range" id="gravity-strength" min="0.1" max="2" step="0.1" value="0.98">
                                <span id="gravity-strength-value">0.98</span>
                            </div>
                        </div>

                        <div class="physics-debug">
                            <h4>Debug & Testing:</h4>
                            <button id="debug-toggle" class="action-btn">ğŸ” Show Debug</button>
                            <button id="debug-log" class="action-btn">ğŸ“Š Log Status</button>
                            <button id="drop-test" class="action-btn">ğŸ¬ Drop Test</button>
                            <button id="basic-test" class="action-btn">ğŸ§ª Basic Test</button>
                        </div>

                        <div id="physics-effect" class="physics-effect"></div>
                    </div>

                    <div class="viewer-section">
                        <div class="model-type-selector">
                            <button class="model-btn" data-model-type="avatar">ğŸ‘¤ Avatar Only</button>
                            <button class="model-btn" data-model-type="garment">ğŸ‘• Garment Only</button>
                            <button class="model-btn active" data-model-type="both">ğŸ­ Combined View</button>
                        </div>
                        <div class="viewer-container">
                            <div class="combined-viewer">
                                <model-viewer id="physics-avatar-viewer" 
                                    camera-controls 
                                    auto-rotate 
                                    environment-image="neutral"
                                    exposure="1"
                                    shadow-intensity="1"
                                    shadow-softness="0.5">
                                </model-viewer>
                                <model-viewer id="physics-garment-viewer" 
                                    camera-controls 
                                    auto-rotate 
                                    environment-image="neutral"
                                    exposure="1"
                                    shadow-intensity="1"
                                    shadow-softness="0.5">
                                </model-viewer>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Environment Tab -->
                <div id="environment-tab" class="tab-content">
                    <div class="controls-section">
                        <h3>Environment & Lighting</h3>
                        
                        <div class="environment-presets">
                            <h4>Environment:</h4>
                            <button class="env-btn active" data-environment="studio">ğŸ¢ Studio</button>
                            <button class="env-btn" data-environment="outdoor">ğŸŒ³ Outdoor</button>
                            <button class="env-btn" data-environment="neutral">âšª Neutral</button>
                        </div>

                        <div class="tone-mapping">
                            <h4>Tone Mapping:</h4>
                            <button class="preset-btn active" data-tone-mapping="aces">ğŸ¨ ACES</button>
                            <button class="preset-btn" data-tone-mapping="linear">ğŸ“ Linear</button>
                            <button class="preset-btn" data-tone-mapping="reinhard">ğŸŒˆ Reinhard</button>
                        </div>

                        <div class="controls">
                            <div class="control-group">
                                <label for="exposure">Exposure:</label>
                                <input type="range" id="exposure" min="0.1" max="3" step="0.1" value="1">
                                <span id="exposure-value">1</span>
                            </div>
                            <div class="control-group">
                                <label for="shadow-intensity">Shadow Intensity:</label>
                                <input type="range" id="shadow-intensity" min="0" max="2" step="0.1" value="1">
                                <span id="shadow-intensity-value">1</span>
                            </div>
                            <div class="control-group">
                                <label for="shadow-softness">Shadow Softness:</label>
                                <input type="range" id="shadow-softness" min="0" max="1" step="0.1" value="0.5">
                                <span id="shadow-softness-value">0.5</span>
                            </div>
                        </div>

                        <div class="camera-controls">
                            <h4>Camera:</h4>
                            <button id="auto-rotate-toggle" class="action-btn">ğŸ”„ Auto Rotate</button>
                            <button id="camera-reset" class="action-btn">ğŸ“· Reset Camera</button>
                            <button id="focus-model" class="action-btn">ğŸ¯ Focus Model</button>
                        </div>

                        <div class="export-controls">
                            <h4>Export:</h4>
                            <button id="take-screenshot" class="action-btn">ğŸ“¸ Screenshot</button>
                            <button id="export-scene" class="action-btn">ğŸ’¾ Export Scene</button>
                        </div>
                    </div>

                    <div class="viewer-section">
                        <div class="model-type-selector">
                            <button class="model-btn" data-model-type="avatar">ğŸ‘¤ Avatar Only</button>
                            <button class="model-btn" data-model-type="garment">ğŸ‘• Garment Only</button>
                            <button class="model-btn active" data-model-type="both">ğŸ­ Combined View</button>
                        </div>
                        <div class="viewer-container">
                            <model-viewer id="environment-viewer" 
                                camera-controls 
                                auto-rotate 
                                environment-image="neutral"
                                exposure="1"
                                shadow-intensity="1"
                                shadow-softness="0.5">
                            </model-viewer>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="main.js"></script>
    <script>
        // Live reload for development
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
            console.log('Live reload enabled.');
            const ws = new WebSocket('ws://localhost:8080');
            ws.onmessage = () => location.reload();
        }
    </script>
</body>
</html>
